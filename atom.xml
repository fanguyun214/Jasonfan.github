<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>http://fanguyun214.github.io</id>
    <title>Jasonfan</title>
    <updated>2019-07-18T15:27:09.888Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="http://fanguyun214.github.io"/>
    <link rel="self" href="http://fanguyun214.github.io/atom.xml"/>
    <subtitle>æŒä¹‹ä»¥æ’ï¼ŒæŒ‘æˆ˜è‡ªæˆ‘ ğŸŒ±ğŸŒ±ğŸŒ±</subtitle>
    <logo>http://fanguyun214.github.io/images/avatar.png</logo>
    <icon>http://fanguyun214.github.io/favicon.ico</icon>
    <rights>All rights reserved 2019, Jasonfan</rights>
    <entry>
        <title type="html"><![CDATA[Apollo Client - 16.Authentication]]></title>
        <id>http://fanguyun214.github.io/post/apollo-client-16authentication</id>
        <link href="http://fanguyun214.github.io/post/apollo-client-16authentication">
        </link>
        <updated>2019-07-18T15:02:35.000Z</updated>
        <summary type="html"><![CDATA[<p>è®¤è¯ã€é™¤éæ‚¨åŠ è½½çš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯å®Œå…¨å…¬å¼€çš„ï¼Œå¦åˆ™æ‚¨çš„åº”ç”¨ç¨‹åºåº”è¯¥æ‹¥æœ‰ç”¨æˆ·ï¼Œå¸æˆ·å’Œæƒé™ç³»ç»Ÿã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>è®¤è¯ã€é™¤éæ‚¨åŠ è½½çš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯å®Œå…¨å…¬å¼€çš„ï¼Œå¦åˆ™æ‚¨çš„åº”ç”¨ç¨‹åºåº”è¯¥æ‹¥æœ‰ç”¨æˆ·ï¼Œå¸æˆ·å’Œæƒé™ç³»ç»Ÿã€‚</p>
<!-- more -->
<p>å¦‚æœä¸åŒçš„ç”¨æˆ·åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­å…·æœ‰ä¸åŒçš„æƒé™ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ä¸€ç§æ–¹æ³•æ¥å‘Šè¯‰æœåŠ¡å™¨å“ªä¸ªç”¨æˆ·ä¸æ¯ä¸ªè¯·æ±‚ç›¸å…³è”ã€‚</p>
<p>Apolloå®¢æˆ·ç«¯ä½¿ç”¨è¶…çµæ´»çš„ <a href="/docs/link">Apollo Link</a>ï¼Œå…¶ä¸­åŒ…æ‹¬å‡ ä¸ªèº«ä»½éªŒè¯é€‰é¡¹ã€‚</p>
<h2 id="cookie">Cookie</h2>
<p>å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºæ˜¯åŸºäºæµè§ˆå™¨çš„ï¼Œå¹¶ä¸”æ‚¨ä½¿ç”¨ cookie è¿›è¡Œåç«¯ç™»å½•å’Œä¼šè¯ç®¡ç†ï¼Œåˆ™å¾ˆå®¹æ˜“å‘Šè¯‰æ‚¨çš„ç½‘ç»œæ¥å£ï¼Œå‘é€ cookie åˆ°æ¯ä¸ªè¯·æ±‚ã€‚ æ‚¨åªéœ€è¦ä¼ é€’å‡­è¯é€‰é¡¹ã€‚ ä¾‹å¦‚ <code>credentialsï¼š'same-origin'</code> å¦‚æœä½ çš„åç«¯æœåŠ¡å™¨æ˜¯åŒä¸€ä¸ªåŸŸï¼Œæˆ–è€…å¦‚æœä½ çš„åç«¯æ˜¯ä¸€ä¸ªä¸åŒçš„åŸŸï¼Œåˆ™ä¸º <code>credentialsï¼š'include'</code>ã€‚</p>
<pre><code class="language-js">const link = createHttpLink({
  uri: '/graphql',
  credentials: 'same-origin'
});

const client = new ApolloClient({
  cache: new InMemoryCache(),
  link,
});
</code></pre>
<p>è¿™ä¸ªé€‰é¡¹ç®€å•åœ°ä¼ é€’ç»™ HttpLink åœ¨å‘é€æŸ¥è¯¢æ—¶ä½¿ç”¨çš„ <a href="https://github.com/github/fetch"><code>fetch</code> implementation</a></p>
<p>æ³¨æ„ï¼šåç«¯è¿˜å¿…é¡»å…è®¸æ¥è‡ªè¯·æ±‚æ¥æºçš„å‡­æ®ã€‚ ä¾‹å¦‚ å¦‚æœåœ¨ node.js ä¸­ä½¿ç”¨æ¥è‡ª npm çš„æµè¡Œ 'cors' åŒ…ï¼Œåˆ™ä»¥ä¸‹è®¾ç½®å°†ä¸ä¸Šè¿° apollo å®¢æˆ·ç«¯è®¾ç½®ååŒå·¥ä½œï¼Œ</p>
<pre><code class="language-js">// enable cors
var corsOptions = {
  origin: '&lt;insert uri of front-end domain&gt;',
  credentials: true // &lt;-- REQUIRED backend setting
};
app.use(cors(corsOptions));
</code></pre>
<h2 id="header">Header</h2>
<p>ä½¿ç”¨ HTTP æ—¶è¯†åˆ«è‡ªå·±çš„å¦ä¸€ç§å¸¸ç”¨æ–¹æ³•æ˜¯åŸºäº header å‘é€è®¤è¯ã€‚é€šè¿‡å°† Apollo Links ç»“åˆåœ¨ä¸€èµ·ï¼Œå¯ä»¥è½»æ¾åœ°ä¸ºæ¯ä¸ª HTTP è¯·æ±‚æ·»åŠ ä¸€ä¸ª <code>authorization</code> æ ‡å¤´ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯æ¬¡å‘é€è¯·æ±‚æ—¶æˆ‘ä»¬éƒ½ä¼šä» <code>localStorage</code> ä¸­æå–ç™»å½•ä»¤ç‰Œï¼š</p>
<pre><code class="language-js">import { ApolloClient } from 'apollo-client';
import { createHttpLink } from 'apollo-link-http';
import { setContext } from 'apollo-link-context';
import { InMemoryCache } from 'apollo-cache-inmemory';

const httpLink = createHttpLink({
  uri: '/graphql',
});

const authLink = setContext((_, { headers }) =&gt; {
  // get the authentication token from local storage if it exists
  const token = localStorage.getItem('token');
  // return the headers to the context so httpLink can read them
  return {
    headers: {
      ...headers,
      authorization: token ? `Bearer ${token}` : &quot;&quot;,
    }
  }
});

const client = new ApolloClient({
  link: authLink.concat(httpLink),
  cache: new InMemoryCache()
});
</code></pre>
<p>è¯·æ³¨æ„ï¼Œä¸Šé¢çš„ç¤ºä¾‹ä½¿ç”¨äº† <code>apollo-client</code> åŒ…ä¸­çš„ <code>ApolloClient</code>ã€‚ è™½ç„¶å¯ä»¥ä½¿ç”¨ <code>apollo-boost</code> åŒ…ä¸­çš„ <code>ApolloClient</code> ä¿®æ”¹ Headersï¼Œä½†ç”±äº <code>apollo-boost</code> ä¸å…è®¸ä¿®æ”¹å®ƒæ‰€ä½¿ç”¨çš„ <code>HttpLink</code> å®ä¾‹ï¼Œæ‰€ä»¥ Headers å¿…é¡»ä½œä¸ºé…ç½®å‚æ•°ä¼ å…¥ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… Apollo Boost <a href="../essentials/get-started.html#configuration">é…ç½®é€‰é¡¹</a> éƒ¨åˆ†ã€‚</p>
<p>æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ header ä¿¡æ¯å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯å¹¶å°†å…¶é™„åŠ åˆ° GraphQL æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå› æ­¤è§£æå™¨å¯ä»¥æ ¹æ®ç”¨æˆ·çš„è§’è‰²å’Œæƒé™ä¿®æ”¹å…¶è¡Œä¸ºã€‚</p>
<h2 id="login-logout">æ³¨é”€æ—¶é‡ç½®å­˜å‚¨</h2>
<p>ç”±äº Apollo ä¼šç¼“å­˜æ‚¨çš„æ‰€æœ‰æŸ¥è¯¢ç»“æœï¼Œå› æ­¤åœ¨ç™»å½•çŠ¶æ€æ›´æ”¹æ—¶åˆ é™¤å®ƒä»¬éå¸¸é‡è¦ã€‚</p>
<p>ç¡®ä¿ UI å’Œå­˜å‚¨çŠ¶æ€åæ˜ çš„æ˜¯å½“å‰ç”¨æˆ·æƒé™çš„æœ€ç®€å•æ–¹æ³•æ˜¯åœ¨ç™»å½•æˆ–æ³¨é”€è¿‡ç¨‹å®Œæˆåè°ƒç”¨ <code>client.resetStore()</code>ã€‚ è¿™å°†å¯¼è‡´æ¸…é™¤å­˜å‚¨å¹¶é‡æ–°è·å–æ‰€æœ‰æŸ¥è¯¢ã€‚ å¦‚æœæ‚¨åªæƒ³æ¸…é™¤å­˜å‚¨å¹¶ä¸”ä¸æƒ³é‡æ–°è·å–æŸ¥è¯¢ï¼Œè¯·ä½¿ç”¨ <code>client.clearStore()</code>ã€‚ å¦ä¸€ç§é€‰æ‹©æ˜¯é‡æ–°åŠ è½½é¡µé¢ï¼Œäº§ç”Ÿç±»ä¼¼çš„æ•ˆæœã€‚</p>
<pre><code class="language-js">const PROFILE_QUERY = gql`
  query CurrentUserForLayout {
    currentUser {
      login
      avatar_url
    }
  }
`;

const Profile = () =&gt; (
  &lt;Query query={PROFILE_QUERY} fetchPolicy=&quot;network-only&quot;&gt;
    {({ client, loading, data: { currentUser } }) =&gt; {
      if (loading) {
        return &lt;p className=&quot;navbar-text navbar-right&quot;&gt;Loading...&lt;/p&gt;;
      }
      if (currentUser) {
        return (
          &lt;span&gt;
            &lt;p className=&quot;navbar-text navbar-right&quot;&gt;
              {currentUser.login}
              &amp;nbsp;
              &lt;button
                onClick={() =&gt; {
                  // call your auth logout code then reset store
                  App.logout().then(() =&gt; client.resetStore());
                }}
              &gt;
                Log out
              &lt;/button&gt;
            &lt;/p&gt;
          &lt;/span&gt;
        );
      }
      return (
        &lt;p className=&quot;navbar-text navbar-right&quot;&gt;
          &lt;a href=&quot;/login/github&quot;&gt;Log in with GitHub&lt;/a&gt;
        &lt;/p&gt;
      );
    }}
  &lt;/Query&gt;
);
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Apollo Client - 2.Query]]></title>
        <id>http://fanguyun214.github.io/post/apollo-client-query</id>
        <link href="http://fanguyun214.github.io/post/apollo-client-query">
        </link>
        <updated>2019-07-18T13:58:56.000Z</updated>
        <summary type="html"><![CDATA[<p>å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Query ç»„ä»¶è·å–æ•°æ®</p>
]]></summary>
        <content type="html"><![CDATA[<p>å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Query ç»„ä»¶è·å–æ•°æ®</p>
<!-- more -->
<p>ä»¥ç®€å•å¯é¢„æµ‹çš„æ–¹å¼è·å–æ•°æ®æ˜¯ Apollo Client çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚ åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•æ„å»º Query ç»„ä»¶ä»¥è·å– GraphQL æ•°æ®å¹¶å°†ç»“æœé™„åŠ åˆ° UIã€‚ æ‚¨è¿˜å°†äº†è§£ Apollo Client å¦‚ä½•é€šè¿‡è·Ÿè¸ªé”™è¯¯å’ŒåŠ è½½çŠ¶æ€æ¥ç®€åŒ–æ•°æ®ç®¡ç†ä»£ç ã€‚</p>
<p>å‡è®¾æ‚¨ç†Ÿæ‚‰æ„å»º GraphQL æŸ¥è¯¢ã€‚ å¦‚æœä½ æƒ³å¤ä¹ ä¸€ä¸‹, æˆ‘ä»¬æ¨è <a href="http://graphql.org/learn/queries/">é˜…è¯»æœ¬æŒ‡å—</a> å’Œç»ƒä¹  <a href="../features/developer-tooling.html#features">åœ¨GraphiQLä¸­è¿è¡ŒæŸ¥è¯¢</a>. ç”±äº Apollo Client æŸ¥è¯¢æ˜¯æ ‡å‡†çš„ GraphQLï¼Œå› æ­¤æ‚¨åœ¨ GraphiQL ä¸­æˆåŠŸè¿è¡Œçš„ä»»ä½•æŸ¥è¯¢ä¹Ÿå°†åœ¨ Apollo Query ç»„ä»¶ä¸­è¿è¡Œã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹å‡è®¾æ‚¨å·²ç»è®¾ç½®äº† Apollo Client å¹¶å°†æ‚¨çš„ React åº”ç”¨ç¨‹åºåŒ…è£…åœ¨ <code>ApolloProvider</code> ç»„ä»¶ä¸­ã€‚ é˜…è¯»æˆ‘ä»¬çš„ <a href="./get-started.html">å…¥é—¨</a> æŒ‡å—, å¦‚æœæ‚¨éœ€è¦æœ‰å…³è¿™ä¸¤ä¸ªæ­¥éª¤çš„å¸®åŠ©ã€‚</p>
<blockquote>
<p>å¦‚æœä½ æƒ³å‚è€ƒè¿™äº›ä¾‹å­ï¼Œè¯·æ‰“å¼€ CodeSandbox ä¸Šçš„ <a href="https://codesandbox.io/s/j2ly83749w">å¯åŠ¨é¡¹ç›®</a>å’Œ <a href="https://codesandbox.IO/S/32ypr38l61">this CodeSandbox</a> ä¸Šçš„ç¤ºä¾‹ GraphQL æœåŠ¡å™¨ã€‚ æ‚¨å¯ä»¥æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„ <a href="https://codesandbox.io/s/n3jykqpxwm">å®Œæ•´ç‰ˆæœ¬</a>ã€‚</p>
</blockquote>
<h2 id="queryç»„ä»¶">Queryç»„ä»¶</h2>
<p>Query ç»„ä»¶æ˜¯ Apollo åº”ç”¨ç¨‹åºæœ€é‡è¦çš„æ„å»ºå—ä¹‹ä¸€ã€‚ è¦åˆ›å»º Query ç»„ä»¶ï¼Œ åªéœ€å°†åŒ…å« <code>gql</code> å‡½æ•°çš„ GraphQL æŸ¥è¯¢å­—ç¬¦ä¸²ä¼ é€’ç»™ <code>this.props.query</code> ï¼Œå¹¶ä¸º <code>this.props.children</code> æä¾›ä¸€ä¸ªå‡½æ•°ï¼Œå‘Šè¯‰ React è¦å‘ˆç°ä»€ä¹ˆã€‚<br>
<code>Query</code> ç»„ä»¶æ˜¯ä½¿ç”¨ <a href="https://reactjs.org/docs/render-props.html">render prop</a> æ¨¡å¼çš„Reactç»„ä»¶çš„ç¤ºä¾‹ã€‚ Reactå°†ä½¿ç”¨ Apollo Client ä¸­çš„å¯¹è±¡è°ƒç”¨æ‚¨æä¾›çš„ render prop å‡½æ•°ï¼Œè¯¥å¯¹è±¡åŒ…å«å¯ç”¨äºå‘ˆç° UI çš„åŠ è½½ï¼Œé”™è¯¯å’Œæ•°æ®å±æ€§ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»º GraphQL æŸ¥è¯¢ã€‚ è¯·è®°ä½å°†æŸ¥è¯¢å­—ç¬¦ä¸²åŒ…è£…åœ¨ <code>gql</code> å‡½æ•°ä¸­ï¼Œä»¥ä¾¿å°†å…¶è§£æä¸ºæŸ¥è¯¢æ–‡æ¡£ã€‚ ä¸€æ—¦æˆ‘ä»¬åˆ›å»ºå¥½ GraphQL æŸ¥è¯¢ï¼Œè®©æˆ‘ä»¬é€šè¿‡å°†å®ƒä¼ é€’ç»™ <code>query</code> prop æ¥å°†å®ƒé™„åŠ åˆ°æˆ‘ä»¬çš„ <code>Query</code> ç»„ä»¶ã€‚</p>
<p>æˆ‘ä»¬è¿˜éœ€è¦ä¸º <code>Query</code> ç»„ä»¶æä¾›ä¸€ä¸ªå­å‡½æ•°ï¼Œå®ƒå°†å‘Šè¯‰ React æˆ‘ä»¬æƒ³è¦å‘ˆç°ä»€ä¹ˆã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Query</code> ç»„ä»¶ä¸ºæˆ‘ä»¬æä¾›çš„ <code>loading</code>ï¼Œ<code>error</code> å’Œ <code>data</code> å±æ€§ï¼Œä»¥ä¾¿æ ¹æ®æŸ¥è¯¢çš„çŠ¶æ€æ™ºèƒ½åœ°å‘ˆç°ä¸åŒçš„ UIã€‚ è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯ä»€ä¹ˆæ ·çš„ï¼</p>
<pre><code class="language-jsx">import gql from &quot;graphql-tag&quot;;
import { Query } from &quot;react-apollo&quot;;

const GET_DOGS = gql`
  {
    dogs {
      id
      breed
    }
  }
`;

const Dogs = ({ onDogSelected }) =&gt; (
  &lt;Query query={GET_DOGS}&gt;
    {({ loading, error, data }) =&gt; {
      if (loading) return &quot;Loading...&quot;;
      if (error) return `Error! ${error.message}`;

      return (
        &lt;select name=&quot;dog&quot; onChange={onDogSelected}&gt;
          {data.dogs.map(dog =&gt; (
            &lt;option key={dog.id} value={dog.breed}&gt;
              {dog.breed}
            &lt;/option&gt;
          ))}
        &lt;/select&gt;
      );
    }}
  &lt;/Query&gt;
);
</code></pre>
<p>å¦‚æœä½ åœ¨ <code>App</code> ç»„ä»¶ä¸­æ¸²æŸ“ <code>Dogs</code>ï¼Œä¸€æ—¦ Apollo Client ä»æœåŠ¡å™¨æ¥æ”¶æ•°æ®ï¼Œä½ å°†é¦–å…ˆçœ‹åˆ°åŠ è½½çŠ¶æ€ï¼Œç„¶åæ˜¯å¸¦æœ‰ç‹—å“ç§åˆ—è¡¨çš„è¡¨å•ã€‚ å½“è¡¨å•å€¼æ”¹å˜æ—¶ï¼Œæˆ‘ä»¬å°†é€šè¿‡ <code>this.props.onDogSelected</code> å°†å€¼å‘é€ç»™çˆ¶ç»„ä»¶ï¼Œ æœ€ç»ˆå°†å€¼ä¼ é€’ç»™ <code>DogPhoto</code> ç»„ä»¶ã€‚</p>
<p>åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡æ„å»ºä¸€ä¸ª <code>DogPhoto</code> ç»„ä»¶å°†è¡¨å•æŒ‚è½½åˆ°ä¸€ä¸ªæ›´å¤æ‚çš„å˜é‡æŸ¥è¯¢ã€‚</p>
<h2 id="æ¥æ”¶æ•°æ®">æ¥æ”¶æ•°æ®</h2>
<p>æ‚¨å·²ç»åœ¨ render prop å‡½æ•°ä¸­çœ‹åˆ°äº†å¦‚ä½•å¤„ç†æŸ¥è¯¢ç»“æœã€‚ å½“æˆ‘ä»¬ä» <code>Query</code> ç»„ä»¶ä¸­è·å–æ•°æ®æ—¶ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Apollo Client å¹•åå‘ç”Ÿçš„äº‹æƒ…ã€‚</p>
<ol>
<li>å½“ <code>Query</code> ç»„ä»¶å®‰è£…æ—¶ï¼ŒApollo Client ä¼šä¸ºæˆ‘ä»¬çš„æŸ¥è¯¢åˆ›å»ºä¸€ä¸ª observableã€‚ æˆ‘ä»¬çš„ç»„ä»¶é€šè¿‡ Apollo Client ç¼“å­˜è®¢é˜…æŸ¥è¯¢ç»“æœã€‚</li>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬å°è¯• ä» Apollo ç¼“å­˜åŠ è½½æŸ¥è¯¢ç»“æœã€‚ å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ã€‚</li>
<li>ä¸€æ—¦æ•°æ®è¿”å›ï¼Œæˆ‘ä»¬å°†å…¶æ ‡å‡†åŒ–å¹¶å°†å…¶å­˜å‚¨åœ¨ Apollo ç¼“å­˜ä¸­ã€‚ ç”±äº <code>Query</code> ç»„ä»¶è®¢é˜…äº†ç»“æœï¼Œå› æ­¤å®ƒä¼šè‡ªåŠ¨æ›´æ–°æ•°æ®ã€‚</li>
</ol>
<p>è¦æŸ¥çœ‹ Apollo Client çš„ç¼“å­˜æ“ä½œï¼Œè®©æˆ‘ä»¬æ„å»ºæˆ‘ä»¬çš„ <code>DogPhoto</code> ç»„ä»¶ã€‚ <code>DogPhoto</code> æ¥å—ä¸€ä¸ªåä¸º <code>breed</code> çš„é“å…·ï¼Œå®ƒåæ˜ äº†ä¸Šé¢ <code>Dogs</code> ç»„ä»¶ä¸­æˆ‘ä»¬è¡¨å•çš„å½“å‰å€¼ã€‚</p>
<pre><code class="language-jsx">const GET_DOG_PHOTO = gql`
  query Dog($breed: String!) {
    dog(breed: $breed) {
      id
      displayImage
    }
  }
`;

const DogPhoto = ({ breed }) =&gt; (
  &lt;Query query={GET_DOG_PHOTO} variables={{ breed }}&gt;
    {({ loading, error, data }) =&gt; {
      if (loading) return null;
      if (error) return `Error!: ${error}`;

      return (
        &lt;img src={data.dog.displayImage} style={{ height: 100, width: 100 }} /&gt;
      );
    }}
  &lt;/Query&gt;
);
</code></pre>
<p>æ‚¨ä¼šæ³¨æ„åˆ° <code>Query</code> ç»„ä»¶ä¸Šæœ‰ä¸€ä¸ªæ–°çš„é…ç½®é€‰é¡¹ã€‚ prop<code>variable</code> æ˜¯ä¸€ä¸ªåŒ…å«æˆ‘ä»¬æƒ³è¦ä¼ é€’ç»™ GraphQL æŸ¥è¯¢çš„å˜é‡å¯¹è±¡ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å°†è¡¨æ ¼ä¸­çš„å“ç§ä¼ é€’ç»™æˆ‘ä»¬çš„æŸ¥è¯¢ã€‚</p>
<p>å°è¯•ä»åˆ—è¡¨ä¸­é€‰æ‹© &quot;bulldog&quot; ä»¥æŸ¥çœ‹å…¶ç…§ç‰‡æ˜¾ç¤ºã€‚ ç„¶åï¼Œåˆ‡æ¢åˆ°å¦ä¸€ä¸ªå“ç§å¹¶åˆ‡æ¢å› &quot;bulldog&quot;ã€‚ ä½ ä¼šæ³¨æ„åˆ°ç‰›å¤´çŠ¬ç…§ç‰‡ç¬¬äºŒæ¬¡ç¬é—´åŠ è½½ã€‚ è¿™æ˜¯ Apollo ç¼“å­˜åœ¨èµ·ä½œç”¨ï¼</p>
<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å­¦ä¹ ä¸€äº›ç¡®ä¿æ•°æ®æ–°é²œçš„æŠ€æœ¯ï¼Œä¾‹å¦‚è½®è¯¢å’Œé‡æ–°è·å–ã€‚</p>
<h2 id="è½®è¯¢å’Œé‡æ–°è·å–">è½®è¯¢å’Œé‡æ–°è·å–</h2>
<p>Apollo Client ä¸ºæ‚¨ç¼“å­˜æ•°æ®çœŸæ˜¯å¤ªæ£’äº†ï¼Œä½†æ˜¯å½“æˆ‘ä»¬éœ€è¦æ–°æ•°æ®æ—¶æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšï¼Ÿ ä¸¤ç§è§£å†³æ–¹æ¡ˆæ˜¯è½®è¯¢å’Œé‡æ–°è·å–ã€‚</p>
<p>è½®è¯¢å¯ä»¥é€šè¿‡åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…é‡æ–°è·å–æ¥å¸®åŠ©æˆ‘ä»¬å®ç°æ¥è¿‘å®æ—¶çš„æ•°æ®ã€‚ è¦å®ç°è½®è¯¢ï¼Œåªéœ€å°† <code>pollInterval</code> propä¼ é€’ç»™ <code>Query</code> ç»„ä»¶ï¼Œé—´éš”ä¸º msã€‚ å¦‚æœä¼ å…¥ 0ï¼ŒæŸ¥è¯¢å°†ä¸ä¼šè½®è¯¢ã€‚ æ‚¨è¿˜å¯ä»¥é€šè¿‡åœ¨ä¼ é€’ç»™ render prop å‡½æ•°çš„ç»“æœå¯¹è±¡ä¸Šä½¿ç”¨ <code>startPolling</code> å’Œ <code>stopPolling</code> å‡½æ•°æ¥å®ç°åŠ¨æ€è½®è¯¢ã€‚</p>
<pre><code class="language-jsx">const DogPhoto = ({ breed }) =&gt; (
  &lt;Query
    query={GET_DOG_PHOTO}
    variables={{ breed }}
    skip={!breed}
    pollInterval={500}
  &gt;
    {({ loading, error, data, startPolling, stopPolling }) =&gt; {
      if (loading) return null;
      if (error) return `Error!: ${error}`;

      return (
        &lt;img src={data.dog.displayImage} style={{ height: 100, width: 100 }} /&gt;
      );
    }}
  &lt;/Query&gt;
);
</code></pre>
<p>é€šè¿‡å°† <code>pollInterval</code> è®¾ç½®ä¸º 500 ï¼Œæ‚¨åº”è¯¥æ¯éš” 0.5 ç§’çœ‹åˆ°ä¸€ä¸ªæ–°çš„ç‹—å›¾åƒã€‚ è½®è¯¢æ˜¯å®ç°è¿‘å®æ—¶æ•°æ®çš„ç»ä½³æ–¹å¼ï¼Œè€Œæ— éœ€å¤æ‚çš„è®¾ç½® GraphQL è®¢é˜…ã€‚</p>
<p>å¦‚æœè¦é‡æ–°åŠ è½½æŸ¥è¯¢ä»¥å“åº”ç”¨æˆ·æ“ä½œè€Œä¸æ˜¯é—´éš”ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ è¿™å°±æ˜¯ <code>refetch</code> å‡½æ•°çš„ç”¨æ­¦ä¹‹åœ°ï¼ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨ <code>DogPhoto</code> ç»„ä»¶ä¸­æ·»åŠ äº†ä¸€ä¸ªæŒ‰é’®ï¼Œè¯¥æŒ‰é’®ä¼šåœ¨å•å‡»æ—¶è§¦å‘é‡æ–°è·å–ã€‚<code>refetch</code> æ¥å—å˜é‡ï¼Œä½†å¦‚æœæˆ‘ä»¬ä¸ä¼ å…¥æ–°å˜é‡ï¼Œå®ƒå°†ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰æŸ¥è¯¢ä¸­çš„ç›¸åŒå˜é‡ã€‚</p>
<pre><code class="language-jsx">const DogPhoto = ({ breed }) =&gt; (
  &lt;Query
    query={GET_DOG_PHOTO}
    variables={{ breed }}
    skip={!breed}
  &gt;
    {({ loading, error, data, refetch }) =&gt; {
      if (loading) return null;
      if (error) return `Error!: ${error}`;

      return (
        &lt;div&gt;
          &lt;img
            src={data.dog.displayImage}
            style={{ height: 100, width: 100 }}
          /&gt;
          &lt;button onClick={() =&gt; refetch()}&gt;Refetch!&lt;/button&gt;
        &lt;/div&gt;
      );
    }}
  &lt;/Query&gt;
);
</code></pre>
<p>å¦‚æœå•å‡»è¯¥æŒ‰é’®ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æˆ‘ä»¬çš„ UI æ›´æ–°äº†æœ€æ–°çš„æ•°æ®ã€‚ é‡æ–°è·å–æ˜¯ä¿è¯æ–°æ•°æ®çš„ä¸€ç§å¾ˆå¥½çš„æ–¹æ³•ï¼Œä½†å®ƒåœ¨åŠ è½½çŠ¶æ€æ—¶å¼•å…¥äº†ä¸€äº›é¢å¤–çš„å¤æ‚æ€§ã€‚ åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¤„ç†å¤æ‚åŠ è½½å’Œé”™è¯¯çŠ¶æ€çš„ç­–ç•¥ã€‚</p>
<h2 id="åŠ è½½å’Œé”™è¯¯çŠ¶æ€">åŠ è½½å’Œé”™è¯¯çŠ¶æ€</h2>
<p>æˆ‘ä»¬å·²ç»çœ‹åˆ° Apollo Client å¦‚ä½•åœ¨æ¸²æŸ“å‡½æ•°ä¸­å…¬å¼€æˆ‘ä»¬çš„æŸ¥è¯¢çš„åŠ è½½å’Œé”™è¯¯çŠ¶æ€ã€‚ è¿™äº›å±æ€§å¯¹äºåˆæ¬¡æŸ¥è¯¢åŠ è½½æ—¶æœ‰ç”¨ï¼Œä½†æ˜¯å½“æˆ‘ä»¬é‡æ–°è·å–æˆ–è½®è¯¢æ—¶ï¼Œæˆ‘ä»¬çš„åŠ è½½çŠ¶æ€ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<p>è®©æˆ‘ä»¬å›åˆ°ä¸Šä¸€èŠ‚ä¸­çš„ç¤ºä¾‹ã€‚ å¦‚æœå•å‡» â€œRefetchâ€ æŒ‰é’®ï¼Œæ‚¨å°†çœ‹åˆ°ç»„ä»¶åœ¨æ–°æ•°æ®åˆ°è¾¾ä¹‹å‰ä¸ä¼šé‡æ–°å‘ˆç°ã€‚ å¦‚æœæˆ‘ä»¬æƒ³å‘ç”¨æˆ·è¡¨æ˜æˆ‘ä»¬æ­£åœ¨é‡æ–°è·å–ç…§ç‰‡æ€ä¹ˆåŠï¼Ÿ</p>
<p>å¹¸è¿çš„æ˜¯ï¼ŒApollo Client é€šè¿‡ render prop å‡½æ•°ä¸­ç»“æœå¯¹è±¡çš„ <code>networkStatus</code> å±æ€§æä¾›æœ‰å…³æŸ¥è¯¢çŠ¶æ€çš„ç»†ç²’åº¦ä¿¡æ¯ã€‚ æˆ‘ä»¬è¿˜éœ€è¦å°† prop çš„ notifyOnNetworkStatusChange è®¾ç½®ä¸º true ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„æŸ¥è¯¢ç»„ä»¶åœ¨é‡æ–°åŠ è½½æ—¶é‡æ–°æ¸²æŸ“ã€‚</p>
<pre><code class="language-jsx">const DogPhoto = ({ breed }) =&gt; (
  &lt;Query
    query={GET_DOG_PHOTO}
    variables={{ breed }}
    skip={!breed}
    notifyOnNetworkStatusChange
  &gt;
    {({ loading, error, data, refetch, networkStatus }) =&gt; {
      if (networkStatus === 4) return &quot;Refetching!&quot;;
      if (loading) return null;
      if (error) return `Error!: ${error}`;

      return (
        &lt;div&gt;
          &lt;img
            src={data.dog.displayImage}
            style={{ height: 100, width: 100 }}
          /&gt;
          &lt;button onClick={() =&gt; refetch()}&gt;Refetch!&lt;/button&gt;
        &lt;/div&gt;
      );
    }}
  &lt;/Query&gt;
);
</code></pre>
<p><code>networkStatus</code> å±æ€§æ˜¯ä¸€ä¸ªæšä¸¾ï¼Œå…¶æ•°å­—å€¼ä¸º 1-8ï¼Œè¡¨ç¤ºä¸åŒçš„åŠ è½½çŠ¶æ€ã€‚ 4 å¯¹åº”é‡æ–°è·å–ï¼Œä½†ä¹Ÿæœ‰ç”¨äºè½®è¯¢å’Œåˆ†é¡µçš„æ•°å­—å€¼ã€‚ æœ‰å…³æ‰€æœ‰å¯èƒ½åŠ è½½çŠ¶æ€çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·æŸ¥çœ‹<a href="../api/react-apollo.html#graphql-query-data-networkStatus">å‚è€ƒæŒ‡å—</a>ã€‚</p>
<p>è™½ç„¶æ²¡æœ‰åŠ è½½çŠ¶æ€é‚£ä¹ˆå¤æ‚ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥é€šè¿‡ <code>Query</code> ç»„ä»¶ä¸Šçš„ <code>errorPolicy</code> prop æ¥è‡ªå®šä¹‰ç»„ä»¶ä¸­çš„é”™è¯¯ã€‚ <code>errorPolicy</code> çš„é»˜è®¤å€¼æ˜¯ â€œnoneâ€ ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰ GraphQL é”™è¯¯è§†ä¸ºè¿è¡Œæ—¶é”™è¯¯ã€‚ å¦‚æœå‘ç”Ÿé”™è¯¯ï¼ŒApollo Client å°†ä¸¢å¼ƒéšè¯·æ±‚è¿”å›çš„ä»»ä½•æ•°æ®ï¼Œå¹¶å°† render prop å‡½æ•°ä¸­çš„ <code>error</code> å±æ€§è®¾ç½®ä¸º trueã€‚ å¦‚æœæ‚¨æƒ³æ˜¾ç¤ºä»»ä½•éƒ¨åˆ†æ•°æ®ä»¥åŠä»»ä½•é”™è¯¯ä¿¡æ¯ï¼Œè¯·å°† <code>errorPolicy</code> è®¾ç½®ä¸º â€œallâ€ã€‚</p>
<h2 id="æ‰‹åŠ¨è§¦å‘æŸ¥è¯¢">æ‰‹åŠ¨è§¦å‘æŸ¥è¯¢</h2>
<p>å½“ React å®‰è£…ä¸€ä¸ª <code>Query</code> ç»„ä»¶æ—¶ï¼ŒApollo Client ä¼šè‡ªåŠ¨è§¦å‘ä½ çš„æŸ¥è¯¢ã€‚ å¦‚æœæ‚¨æƒ³å»¶è¿Ÿè§¦å‘æŸ¥è¯¢ï¼Œç›´åˆ°ç”¨æˆ·æ‰§è¡Œæ“ä½œï¼ˆä¾‹å¦‚å•å‡»æŒ‰é’®ï¼‰ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æƒ³è¦ä½¿ç”¨ <code>ApolloConsumer</code> ç»„ä»¶å¹¶ç›´æ¥è°ƒç”¨ <code>client.query()</code>ã€‚</p>
<pre><code class="language-jsx">import React, { Component } from 'react';
import { ApolloConsumer } from 'react-apollo';

class DelayedQuery extends Component {
  state = { dog: null };

  onDogFetched = dog =&gt; this.setState(() =&gt; ({ dog }));

  render() {
    return (
      &lt;ApolloConsumer&gt;
        {client =&gt; (
          &lt;div&gt;
            {this.state.dog &amp;&amp; &lt;img src={this.state.dog.displayImage} /&gt;}
            &lt;button
              onClick={async () =&gt; {
                const { data } = await client.query({
                  query: GET_DOG_PHOTO,
                  variables: { breed: &quot;bulldog&quot; }
                });
                this.onDogFetched(data.dog);
              }}
            &gt;
              Click me!
            &lt;/button&gt;
          &lt;/div&gt;
        )}
      &lt;/ApolloConsumer&gt;
    );
  }
}
</code></pre>
<p>ä»¥è¿™ç§æ–¹å¼è·å–æ˜¯éå¸¸å†—é•¿çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å»ºè®®å°½å¯èƒ½ä½¿ç”¨ <code>Query</code> ç»„ä»¶ï¼</p>
<blockquote>
<p>å¦‚æœæ‚¨æƒ³æŸ¥çœ‹æˆ‘ä»¬åˆšåˆšæ„å»ºçš„åº”ç”¨ç¨‹åºçš„å®Œæ•´ç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹CodeSandbox <a href="https://codesandbox.io/s/n3jykqpxwm">æ­¤å¤„</a>.</p>
</blockquote>
<h2 id="query-api-æ¦‚è§ˆ">Query API æ¦‚è§ˆ</h2>
<p>å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾æ‰€æœ‰ <code>Query</code> ç»„ä»¶æ¥å—åŠå…¶æ¸²æŸ“æ–¹æ³•åŠŸèƒ½çš„æ¦‚è¿°ï¼Œè¯·ä¸è¦å†çœ‹äº†ï¼ å¤§å¤šæ•° <code>Query</code> ç»„ä»¶ä¸éœ€è¦æ‰€æœ‰è¿™äº›é…ç½®é€‰é¡¹ï¼Œä½†çŸ¥é“å®ƒä»¬å­˜åœ¨æ˜¯æœ‰ç”¨çš„ã€‚ å¦‚æœæ‚¨æƒ³é€šè¿‡ä½¿ç”¨ç¤ºä¾‹æ›´è¯¦ç»†åœ°äº†è§£ <code>Query</code> ç»„ä»¶ APIï¼Œè¯·è®¿é—®æˆ‘ä»¬çš„<a href="../api/react-apollo.html">å‚è€ƒæŒ‡å—</a>.</p>
<h3 id="props">Props</h3>
<p>Query ç»„ä»¶æ¥å—ä»¥ä¸‹ propsã€‚ åªæœ‰ <code>query</code> å’Œ <code>children</code>æ˜¯å¿…é¡»çš„ <strong>required</strong>.</p>
<dl>
  <dt>`query`: DocumentNode</dt>
  <dd>GraphQLæŸ¥è¯¢æ–‡æ¡£é€šè¿‡`graphql-tag`è§£æä¸ºASTã€‚ **Required**</dd>
  <dt>`children`: (result: QueryResult) => React.ReactNode</dt>
  <dd>ä¸€ä¸ªå‡½æ•°ï¼Œæ ¹æ®æŸ¥è¯¢ç»“æœè¿”å›è¦æ¸²æŸ“çš„ UIã€‚**Required**</dd>
  <dt>`variables`: { [key: string]: any }</dt>
  <dd>åŒ…å«æ‰§è¡ŒæŸ¥è¯¢éœ€è¦çš„æ‰€æœ‰å˜é‡å¯¹è±¡</dd>
  <dt>`pollInterval`: number</dt>
  <dd>æŒ‡å®šç»„ä»¶è½®è¯¢æ•°æ®çš„æ—¶é—´é—´éš”ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚ é»˜è®¤ä¸º 0ï¼ˆæ— è½®è¯¢ï¼‰ã€‚</dd>
  <dt>`notifyOnNetworkStatusChange`: boolean</dt>
  <dd>æ˜¯å¦æ›´æ–°ç½‘ç»œçŠ¶æ€æˆ–ç½‘ç»œé”™è¯¯åº”é‡æ–°å‘ˆç°ç»„ä»¶ã€‚ é»˜è®¤ä¸ºfalseã€‚</dd>
  <dt>`fetchPolicy`: FetchPolicy</dt>
  <dd>æ‚¨å¸Œæœ›ç»„ä»¶å¦‚ä½•ä¸ Apollo ç¼“å­˜äº¤äº’ã€‚ é»˜è®¤ä¸º â€œcache-firstâ€ã€‚</dd>
  <dt>`errorPolicy`: ErrorPolicy</dt>
  <dd>æ‚¨å¸Œæœ›ç»„ä»¶å¦‚ä½•å¤„ç†ç½‘ç»œå’Œ GraphQL é”™è¯¯ã€‚ é»˜è®¤ä¸º â€œnoneâ€ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å°† GraphQL é”™è¯¯è§†ä¸ºè¿è¡Œæ—¶é”™è¯¯ã€‚</dd>
  <dt>`ssr`: boolean</dt>
  <dd>ä¼ å…¥ false ä»¥åœ¨æœåŠ¡ç«¯æ¸²æŸ“æœŸé—´è·³è¿‡æŸ¥è¯¢ã€‚</dd>
  <dt>`displayName`: string</dt>
  <dd>è¦åœ¨ React DevTools ä¸­æ˜¾ç¤ºçš„ç»„ä»¶çš„åç§°ã€‚ é»˜è®¤ä¸º 'Query'ã€‚</dd>
  <dt>`skip`: boolean</dt>
  <dd>å¦‚æœ skip ä¸º trueï¼Œåˆ™å°†å®Œå…¨è·³è¿‡æŸ¥è¯¢ã€‚</dd>
  <dt>`onCompleted`: (data: TData | {}) => void</dt>
  <dd>æŸ¥è¯¢æˆåŠŸå®Œæˆåæ‰§è¡Œçš„å›è°ƒã€‚</dd>
  <dt>`onError`: (error: ApolloError) => void</dt>
  <dd>å‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œçš„å›è°ƒã€‚</dd>
  <dt>`context`: Record<string, any></dt>
  <dd>æŸ¥è¯¢ç»„ä»¶ä¸ç½‘ç»œæ¥å£ï¼ˆApollo Linkï¼‰ä¹‹é—´çš„å…±äº«ä¸Šä¸‹æ–‡ã€‚ ç”¨äºä»é“å…·è®¾ç½®æ ‡é¢˜æˆ–å°†ä¿¡æ¯å‘é€åˆ° Apollo Boost çš„ `request` åŠŸèƒ½ã€‚</dd>
  <dt>`partialRefetch`: boolean</dt>
  <dd>å¦‚æœæ˜¯ `true`ï¼Œå¦‚æœæŸ¥è¯¢ç»“æœè¢«æ ‡è®°ä¸ºéƒ¨åˆ†ï¼Œåˆ™æ‰§è¡ŒæŸ¥è¯¢ `refetch`ï¼Œå¹¶ä¸”ç”± Apollo Client `QueryManager` å°†è¿”å›çš„æ•°æ®é‡ç½®ä¸ºç©ºå¯¹è±¡ï¼ˆç”±äºé«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ï¼‰ã€‚ å‡ºäºå‘åå…¼å®¹æ€§çš„åŸå› ï¼Œé»˜è®¤å€¼ä¸º â€œfalseâ€ï¼Œä½†å¯¹äºå¤§å¤šæ•°å®ä¾‹ï¼Œåº”å°†å…¶æ›´æ”¹ä¸ºtrueã€‚</dd>
</dl>
<h3 id="render-prop-function">Render prop function</h3>
<p>ä½¿ç”¨å…·æœ‰ä»¥ä¸‹å±æ€§çš„å¯¹è±¡ï¼ˆ<code>QueryResult</code>ï¼‰è°ƒç”¨ä¼ é€’ç»™ <code>Query</code> çš„ <code>children</code> prop çš„ render prop å‡½æ•°ã€‚ æ­¤å¯¹è±¡åŒ…å«æ‚¨çš„æŸ¥è¯¢ç»“æœï¼Œä»¥åŠä¸€äº›æœ‰ç”¨çš„å‡½æ•°ï¼Œç”¨äºé‡æ–°è·å–ï¼ŒåŠ¨æ€è½®è¯¢å’Œåˆ†é¡µã€‚</p>
<dl>
  <dt>`data`: TData</dt>
  <dd>åŒ…å« GraphQL æŸ¥è¯¢ç»“æœçš„å¯¹è±¡ã€‚ é»˜è®¤ä¸ºç©ºå¯¹è±¡ã€‚</dd>
  <dt>`loading`: boolean</dt>
  <dd>ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºè¯·æ±‚æ˜¯å¦åœ¨æ‰§è¡Œä¸­</dd>
  <dt>`error`: ApolloError</dt>
  <dd>ä½¿ç”¨ `graphQLErrors` å’Œ `networkError` å±æ€§çš„è¿è¡Œæ—¶é”™è¯¯</dd>
  <dt>`variables`: { [key: string]: any }</dt>
  <dd>åŒ…å«è°ƒç”¨æŸ¥è¯¢çš„å˜é‡å¯¹è±¡</dd>
  <dt>`networkStatus`: NetworkStatus</dt>
  <dd>1-8 ä¹‹é—´çš„æ•°å­—ï¼Œå¯¹åº”ç½‘ç»œè¯·æ±‚çš„è¯¦ç»†çŠ¶æ€ã€‚ åŒ…æ‹¬æœ‰å…³é‡æ–°è·å–å’Œè½®è¯¢çŠ¶æ€çš„ä¿¡æ¯ã€‚ ä¸ `notifyOnNetworkStatusChange` é“å…·ä¸€èµ·ä½¿ç”¨ã€‚
</dd>
  <dt>`refetch`: (variables?: TVariables) => Promise<ApolloQueryResult></dt>
  <dd>ä¸€ä¸ªå…è®¸æ‚¨é‡æ–°è·å–æŸ¥è¯¢å¹¶å¯é€‰åœ°ä¼ å…¥æ–°å˜é‡çš„å‡½æ•°</dd>
  <dt>`fetchMore`: ({ query?: DocumentNode, variables?: TVariables, updateQuery: Function}) => Promise<ApolloQueryResult></dt>
  <dd>ä¸ºæ‚¨çš„æŸ¥è¯¢å¯ç”¨ [pagination](../features/pagination.html) çš„å‡½æ•°</dd>
  <dt>`startPolling`: (interval: number) => void</dt>
  <dd>æ­¤å‡½æ•°ä»¥ ms ä¸ºå•ä½è®¾ç½®é—´éš”ï¼Œå¹¶åœ¨æ¯æ¬¡æŒ‡å®šçš„é—´éš”é€šè¿‡æ—¶è·å–æŸ¥è¯¢ã€‚</dd>
  <dt>`stopPolling`: () => void</dt>
  <dd>æ­¤å‡½æ•°åœæ­¢æŸ¥è¯¢è½®è¯¢ã€‚</dd>
  <dt>`subscribeToMore`: (options: { document: DocumentNode, variables?: TVariables, updateQuery?: Function, onError?: Function}) => () => void</dt>
  <dd>è®¾ç½® [subscription](../advanced/subscriptions.html) çš„å‡½æ•°ã€‚ `subscribeToMore` è¿”å›ä¸€ä¸ªå¯ç”¨äºå–æ¶ˆè®¢é˜…çš„å‡½æ•°ã€‚</dd>
  <dt>`updateQuery`: (previousResult: TData, options: { variables: TVariables }) => TData</dt>
  <dd>å‡½æ•°ï¼Œå…è®¸æ‚¨åœ¨è·å–ï¼Œå˜å¼‚æˆ–è®¢é˜…çš„ä¸Šä¸‹æ–‡ä¹‹å¤–çš„ç¼“å­˜ä¸­æ›´æ–°æŸ¥è¯¢çš„ç»“æœ</dd>
  <dt>`client`: ApolloClient</dt>
  <dd>ä½ çš„ 'ApolloClient` å®ä¾‹ã€‚ ç”¨äºæ‰‹åŠ¨è§¦å‘æŸ¥è¯¢æˆ–å°†æ•°æ®å†™å…¥ã€‚</dd>
</dl>
<h2 id="ä¸‹ä¸€æ­¥">ä¸‹ä¸€æ­¥</h2>
<p>å­¦ä¹ å¦‚ä½•æ„å»º <code>Query</code> ç»„ä»¶æ¥è·å–æ•°æ®æ˜¯æŒæ¡ Apollo Client å¼€å‘çš„æœ€é‡è¦æŠ€èƒ½ä¹‹ä¸€ã€‚ æ—¢ç„¶æ‚¨æ˜¯è·å–æ•°æ®çš„ä¸“å®¶ï¼Œä¸ºä»€ä¹ˆä¸å°è¯•æ„å»º <code>Mutation</code> ç»„ä»¶æ¥æ›´æ–°æ‚¨çš„æ•°æ®ï¼Ÿ ä»¥ä¸‹æ˜¯æˆ‘ä»¬è®¤ä¸ºå¯ä»¥å¸®åŠ©æ‚¨æå‡æŠ€èƒ½çš„ä¸€äº›èµ„æºï¼š</p>
<ul>
<li><a href="./mutations.html">Mutations</a>: äº†è§£å¦‚ä½•ä½¿ç”¨çªå˜æ›´æ–°æ•°æ®ä»¥åŠä½•æ—¶éœ€è¦æ›´æ–° Apollo ç¼“å­˜ã€‚ æœ‰å…³é€‰é¡¹çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·æŸ¥çœ‹ <code>Mutation</code> ç»„ä»¶çš„APIå‚è€ƒã€‚</li>
<li><a href="./local-state.html">Local state management</a>: å­¦ä¹ å¦‚ä½•ä½¿ç”¨ <code>apollo-link-state</code> æŸ¥è¯¢æœ¬åœ°æ•°æ®ã€‚</li>
<li><a href="../features/pagination.html">Pagination</a>: åŸºäº Apollo Client çš„ <code>fetchMore</code> åŠŸèƒ½ï¼Œæ„å»ºåˆ—è¡¨ä»æœªå¦‚æ­¤ç®€å•ã€‚ åœ¨æˆ‘ä»¬çš„åˆ†é¡µæ•™ç¨‹ä¸­äº†è§£æ›´å¤šä¿¡æ¯ã€‚</li>
<li><a href="https://youtu.be/YHJ2CaS0vpM">Query component video by Sara Vieira</a>: å¦‚æœæ‚¨éœ€è¦é€šè¿‡è§‚çœ‹è§†é¢‘è¿›è¡Œå¤ä¹ æˆ–å­¦ä¹ ï¼Œè¯·æŸ¥çœ‹ Sara çš„ <code>Query</code> ç»„ä»¶çš„æ•™ç¨‹ï¼</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Gitlab-CIå‰ç«¯æŒç»­é›†æˆ]]></title>
        <id>http://fanguyun214.github.io/post/gitlab-ci-qian-duan-chi-xu-ji-cheng</id>
        <link href="http://fanguyun214.github.io/post/gitlab-ci-qian-duan-chi-xu-ji-cheng">
        </link>
        <updated>2019-07-18T10:15:48.000Z</updated>
        <summary type="html"><![CDATA[<p>gitlab-ci å…¨ç§°æ˜¯ gitlab continuous integrationï¼Œä¹Ÿå°±æ˜¯åŸºäºgitlabçš„æŒç»­é›†æˆå·¥å…·ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>gitlab-ci å…¨ç§°æ˜¯ gitlab continuous integrationï¼Œä¹Ÿå°±æ˜¯åŸºäºgitlabçš„æŒç»­é›†æˆå·¥å…·ã€‚</p>
<!-- more -->
<h2 id="1-gitlab-ci-gitlab-ci-runner">1ã€Gitlab-ci &amp;&amp; Gitlab-ci-runner</h2>
<p><strong>gitlab-ci</strong></p>
<p>ä¸­å¿ƒæ€æƒ³æ˜¯å½“æ¯ä¸€æ¬¡pushåˆ°gitlabçš„æ—¶å€™ï¼Œéƒ½ä¼šè§¦å‘ä¸€æ¬¡è„šæœ¬æ‰§è¡Œï¼Œç„¶åè„šæœ¬çš„å†…å®¹åŒ…æ‹¬äº†æµ‹è¯•ï¼Œç¼–è¯‘ï¼Œéƒ¨ç½²ç­‰ä¸€ç³»åˆ—è‡ªå®šä¹‰çš„å†…å®¹ã€‚é«˜ç‰ˆæœ¬çš„ GitLab è‡ªå¸¦äº† GitLab CIï¼Œæ‰€ä»¥ä¸éœ€è¦å¦å¤–å®‰è£…ã€‚</p>
<p><strong>GitLab-Runner</strong></p>
<p>GitLab-Runner æ˜¯è„šæœ¬æ‰§è¡Œçš„æ‰¿è½½è€…ï¼ŒGitLab-CI äº‹å…ˆæ³¨å†Œå¥½ GitLab-Runnerï¼Œå† push ä»£ç ï¼Œå¯¹åº”çš„ Runner å°±ä¼šæ‰§è¡Œä½ æ‰€å®šä¹‰çš„è„šæœ¬ã€‚</p>
<p><strong>æœ¬åœ°push -&gt; .gitlab-ci.ymlé…ç½® -&gt; GitLab-Runneræ‰§è¡Œè„šæœ¬ -&gt; éƒ¨ç½²å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§æœåŠ¡å™¨</strong></p>
<h2 id="2-å®‰è£…gitlab-runner">2ã€å®‰è£…GitLab-Runner</h2>
<p>Gitlab Runnerå®‰è£…æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç›´æ¥äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ï¼Œä¸€ç§æ˜¯åŸºäºdockeré•œåƒå®‰è£…ã€‚</p>
<p><strong>äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…</strong></p>
<ul>
<li>ä¸‹è½½å¯¹åº”æ“ä½œç³»ç»Ÿçš„äºŒè¿›åˆ¶åŒ…ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯macç‰ˆæœ¬ï¼Œ</li>
</ul>
<pre><code>sudo curl --output /usr/local/bin/gitlab-ci-multi-runner https://gitlab-ci-multi-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-ci-multi-runner-darwin-amd64
</code></pre>
<ul>
<li>ç»™ gitlab-ci-multi-runner è®¾ç½®æƒé™</li>
</ul>
<pre><code>sudo chmod +x /usr/local/bin/gitlab-ci-multi-runner
</code></pre>
<p>ä»¥ä¸Šæ˜¯å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼Œå¦‚æœæœ‰é—®é¢˜ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ°<a href="https://gitlab-ci-multi-runner-downloads.s3.amazonaws.com/v1.11.2/index.html">ç‰ˆæœ¬ä¸‹è½½åˆ—è¡¨</a>ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬ï¼Œç„¶åå¤åˆ¶åˆ°/usr/local/bin/ç›®å½•ä¸‹</p>
<ul>
<li>æ³¨å†Œrunner<br>
é¦–å…ˆï¼Œè¿›å…¥åˆ°ä½ çš„ gitlab é¡¹ç›®ç½‘é¡µï¼Œæ‰¾åˆ° Settings -&gt; CI/CD -&gt; Runnerï¼Œç„¶åæ‰¾åˆ°å¯¹åº”çš„ url å’Œ token</li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2019/4/17/16a2940147be83f1?w=901&amp;h=557&amp;f=png&amp;s=127905" alt=""></p>
<p>ç„¶ååœ¨ç»ˆç«¯è¾“å…¥</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/4/17/16a2941c0497ad6f?w=1071&amp;h=379&amp;f=png&amp;s=157806" alt=""><br>
ä¾æ¬¡æ˜¯url,token,æè¿°,tag,æ˜¯å¦å…±äº«,æ‰§è¡Œæ–¹å¼</p>
<p>å¯åŠ¨Runnerï¼Œ<code>gitlab-ci-multi-runner start</code>ï¼Œåˆ·æ–°é¡µé¢</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/4/17/16a2948a0bcf3446?w=494&amp;h=190&amp;f=png&amp;s=17239" alt=""><br>
è¯´æ˜æ³¨å†ŒæˆåŠŸäº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ gitlab-ci-multi-runner list æŸ¥è¯¢ä½ æ³¨å†Œçš„runner ï¼Œç”¨ gitlab-ci-multi-runner status æŸ¥çœ‹ runner æœåŠ¡æ˜¯å¦è¿è¡Œä¸­ã€‚</p>
<p><strong>åŸºäºDockerå®‰è£…</strong></p>
<ul>
<li>å…ˆè·å– gitlab-runner é•œåƒ</li>
</ul>
<pre><code>sudo docker pull gitlab/gitlab-runner:latest
</code></pre>
<ul>
<li>å¯åŠ¨ gitlab-runner container</li>
</ul>
<pre><code>sudo docker run -d --name gitlab-runner --restart always \
  -v /srv/gitlab-runner/config:/etc/gitlab-runner \
  -v /var/run/docker.sock:/var/run/docker.sock \
  gitlab/gitlab-runner:latest
</code></pre>
<ul>
<li>æ³¨å†Œrunner</li>
</ul>
<pre><code>sudo docker exec -it gitlab-runner gitlab-ci-multi-runner register
æ³¨å†Œæ–¹å¼åŒä¸Š
</code></pre>
<h2 id="3-é…ç½®gitlab-ciyml">3ã€é…ç½®.gitlab-ci.yml</h2>
<p>GitLab CIçš„ä¸€åˆ‡å·¥ä½œï¼Œéƒ½æ˜¯ç”± .gitlab-ci.yml æ¥é…ç½®çš„ã€‚è¯¦ç»†æ–‡æ¡£å¯ä»¥å‚è€ƒ<a href="https://docs.gitlab.com/ee/ci/yaml/README.html">è¿™é‡Œ</a></p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º .gitlab-ci.yml æ–‡ä»¶</p>
<pre><code># è®¾ç½®ç¼“å­˜
cache:
  paths:
    - node_modules/
    - dist/
# å®šä¹‰ stagesï¼Œç”¨æ¥å®šä¹‰å·¥ä½œé˜¶æ®µï¼Œå¤šä¸ª stages ä¼šæŒ‰é¡ºåºè¿›è¡Œ
stages:
  - build
  - test
  - deploy
# before_script ä¼šåœ¨æ¯ä¸ª stages æ‰§è¡Œä¹‹å‰è¿è¡Œ
before_script:
  - node -v
  - yarn --version
  - yarn global add umi
  - yarn install
  
# æµ‹è¯•ï¼ˆå¯¹åº”ä¸Šé¢stagesï¼‰
test:
  stage: test
  script:
    - echo 'yarn test'
    - yarn test
# æ„å»º
build:
  stage: build
  script:
    - echo 'yarn build'
    - yarn build
  when: manual # æ‰‹åŠ¨è§¦å‘
# éƒ¨ç½²
deploy:
  stage: deploy
  only:
    - master
  script:
    - bash scripts/deploy.sh # éƒ¨ç½²è„šæœ¬æ–‡ä»¶
  when: manual
</code></pre>
<p>é…ç½®å®Œæˆæäº¤Gitpabåï¼Œæ¯æ¬¡pushéƒ½ä¼šè§¦å‘gitlab-ciã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/4/17/16a2955cb45a52b4?w=1048&amp;h=243&amp;f=png&amp;s=46518" alt=""></p>
<h2 id="4å‚è€ƒèµ„æ–™">4.å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://docs.gitlab.com/runner/install/osx.html">gitlab-runner å®‰è£…</a></li>
<li><a href="https://docs.gitlab.com/ee/ci/yaml/README.html">gitlab ci yaml é…ç½®</a></li>
<li><a href="https://www.jianshu.com/p/df433633816b">ã€åç«¯ã€‘gitlabä¹‹gitlab-ciè‡ªåŠ¨éƒ¨ç½²</a></li>
<li><a href="https://juejin.im/post/5d00acd26fb9a07eca69745b">å‰ç«¯åŸºäºSSHçš„è‡ªåŠ¨éƒ¨ç½²</a></li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å‰ç«¯åŸºäºSSHçš„è‡ªåŠ¨éƒ¨ç½²]]></title>
        <id>http://fanguyun214.github.io/post/qian-duan-ji-yu-ssh-de-zi-dong-bu-shu</id>
        <link href="http://fanguyun214.github.io/post/qian-duan-ji-yu-ssh-de-zi-dong-bu-shu">
        </link>
        <updated>2019-07-18T09:59:12.000Z</updated>
        <summary type="html"><![CDATA[<p>SSHæ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œç”¨äºè®¡ç®—æœºä¹‹é—´çš„åŠ å¯†ç™»å½•ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>SSHæ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œç”¨äºè®¡ç®—æœºä¹‹é—´çš„åŠ å¯†ç™»å½•ã€‚</p>
<!-- more -->
<h3 id="sshç®€ä»‹">sshç®€ä»‹</h3>
<p>åŸç†ï¼š</p>
<ul>
<li>è¿œç¨‹ä¸»æœºæ”¶åˆ°ç”¨æˆ·çš„ç™»å½•è¯·æ±‚ï¼ŒæŠŠè‡ªå·±çš„å…¬é’¥å‘ç»™ç”¨æˆ·ã€‚</li>
<li>ç”¨æˆ·ä½¿ç”¨è¿™ä¸ªå…¬é’¥ï¼Œå°†ç™»å½•å¯†ç åŠ å¯†åï¼Œå‘é€å›æ¥ã€‚</li>
<li>è¿œç¨‹ä¸»æœºç”¨è‡ªå·±çš„ç§é’¥ï¼Œè§£å¯†ç™»å½•å¯†ç ï¼Œå¦‚æœå¯†ç æ­£ç¡®ï¼Œå°±åŒæ„ç”¨æˆ·ç™»å½•ã€‚</li>
</ul>
<p>å½“è¿œç¨‹ä¸»æœºçš„å…¬é’¥è¢«æ¥å—ä»¥åï¼Œå®ƒå°±ä¼šè¢«ä¿å­˜åœ¨æœ¬åœ°æ–‡ä»¶~/.ssh/known_hostsä¹‹ä¸­ï¼Œæ­¤å¤–ç³»ç»Ÿä¹Ÿæœ‰ä¸€ä¸ªè¿™æ ·çš„æ–‡ä»¶ï¼Œé€šå¸¸æ˜¯/etc/ssh/ssh_known_hostsï¼Œä¿å­˜ä¸€äº›å¯¹æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä¿¡èµ–çš„è¿œç¨‹ä¸»æœºçš„å…¬é’¥ã€‚</p>
<h3 id="å¸¸ç”¨æŒ‡ä»¤">å¸¸ç”¨æŒ‡ä»¤</h3>
<ul>
<li>æœ¬åœ°ç™»å½•æœåŠ¡å™¨ ssh user@remote -p portï¼Œç«¯å£æ˜¯22çš„è¯ssh user@remoteï¼Œé€€å‡ºç™»å½•exit</li>
<li>æœ¬åœ°å…å¯†ç ç™»å½• ssh-copy-id user@remote -p portï¼Œè¿™åœ¨å†™è„šæœ¬æœåŠ¡å™¨æ§åˆ¶æ—¶ç‰¹åˆ«æœ‰ç”¨</li>
<li>ç»™æœåŠ¡å™¨é…ç½®åˆ«å code ~/.ssh/configè¿½åŠ ä¸€äº›å†…å®¹ï¼Œå°±å¯ä»¥ssh selfnameç™»å½•ï¼Œä¸å†éœ€è¦è®°æœåŠ¡å™¨ipåœ°å€äº†</li>
<li>æ‰§è¡Œå‘½ä»¤ssh selfname &quot;cd ~;ls&quot;ï¼Œå°†ä¼šåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå¼•å·é‡Œçš„å‘½ä»¤ï¼Œæ‰§è¡Œä¹‹åå…¶è‡ªåŠ¨å…³é—­è¿œç¨‹æœåŠ¡</li>
<li>å°†aç”µè„‘æ–‡ä»¶(å¤¹)å¤åˆ¶åˆ°bç”µè„‘ä¸Šå“ªä¸ªæ–‡ä»¶å¤¹ä¸‹é¢ï¼šscp username@aç”µè„‘ip:æ–‡ä»¶è·¯å¾„ username@bç”µè„‘ip:æ–‡ä»¶å¤¹è·¯å¾„ï¼Œæ˜¯æ–‡ä»¶å¤¹çš„è¯åŠ ä¸Š-rï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ç”¨åˆ«åï¼Œé€šå¸¸æœ¬æœºçš„è¯çœç•¥username@aç”µè„‘ip:</li>
</ul>
<pre><code>ssh user@remote -p port

# user æ˜¯ä½ åœ¨è¿œç¨‹æœºå™¨ä¸Šçš„ç”¨æˆ·åï¼Œå¦‚æœä¸æŒ‡å®šçš„è¯é»˜è®¤ä¸ºå½“å‰ç”¨æˆ·
# remote æ˜¯è¿œç¨‹æœºå™¨çš„åœ°å€ï¼Œå¯ä»¥æ˜¯ IPï¼ŒåŸŸåï¼Œæˆ–è€…æ˜¯åé¢ä¼šæåˆ°çš„åˆ«å
# port æ˜¯ SSH Server ç›‘å¬çš„ç«¯å£ï¼Œå¦‚æœä¸æŒ‡å®šçš„è¯å°±ä¸ºé»˜è®¤å€¼ 22
# æ¯”å¦‚æˆ‘å¸¸ç”¨çš„ ssh zhm@120.79.52.223

</code></pre>
<p>é€šå¸¸åœ¨æœ¬åœ°ç”µè„‘è¾“å…¥ä»¥ä¸Šå‘½ä»¤ä¹‹åï¼Œè¿œç¨‹æœåŠ¡å™¨å°±ä¼šè¯¢é—®å¯†ç ï¼Œä½ è¾“å…¥çš„æ—¶å€™æ˜¯çœ‹ä¸è§ä»»ä½•æ³¢åŠ¨ï¼Œè¾“å…¥å®Œå›è½¦å°±å¯ä»¥äº†~ï¼Œå¦‚æœæŠ¥é”™ssh: connect to host remote port 22: Connection refusedï¼Œè¯´æ˜æœåŠ¡å™¨æ²¡æœ‰æŒ‰ç…§ssh serverï¼ŒUbantu Desktopç³»ç»Ÿé»˜è®¤æ˜¯æ²¡æœ‰è¿™ä¸ªçš„ï¼Œå®‰è£…å‘½ä»¤sudo apt-get install openssh-server</p>
<h3 id="å…å¯†ç™»å½•">å…å¯†ç™»å½•</h3>
<p>æ¯æ¬¡ ssh éƒ½è¦è¾“å…¥å¯†ç æ˜¯ä¸æ˜¯å¾ˆçƒ¦å‘¢ï¼Ÿä¸å¯†ç éªŒè¯ç›¸å¯¹çš„ï¼Œæ˜¯å…¬é’¥éªŒè¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦å®ç°å…å¯†ç ç™»å…¥ï¼Œé¦–å…ˆè¦è®¾ç½® SSH é’¥åŒ™ã€‚ä¹Ÿå°±æ˜¯æœ¬åœ°ç”µè„‘ç”Ÿæˆå…¬é’¥ç§é’¥ï¼Œç„¶åæŠŠå…¬é’¥æ”¾åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šå°±å¯ä»¥äº†ï¼<br>
åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨æˆ·å°†è‡ªå·±çš„å…¬é’¥å‚¨å­˜åœ¨è¿œç¨‹ä¸»æœºä¸Šã€‚ç™»å½•çš„æ—¶å€™ï¼Œè¿œç¨‹ä¸»æœºä¼šå‘ç”¨æˆ·å‘é€ä¸€æ®µéšæœºå­—ç¬¦ä¸²ï¼Œç”¨æˆ·ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†åï¼Œå†å‘å›æ¥ã€‚è¿œç¨‹ä¸»æœºç”¨äº‹å…ˆå‚¨å­˜çš„å…¬é’¥è¿›è¡Œè§£å¯†ï¼Œå¦‚æœæˆåŠŸï¼Œå°±è¯æ˜ç”¨æˆ·æ˜¯å¯ä¿¡çš„ï¼Œç›´æ¥å…è®¸ç™»å½•shellï¼Œä¸å†è¦æ±‚å¯†ç ã€‚</p>
<pre><code># æŸ¥çœ‹æœ¬åœ°æœ‰æ²¡æœ‰
ls ~/.ssh
# æ²¡æœ‰å°±ç”Ÿæˆ
ssh-keygen
# åœ¨~/.ssh/ç›®å½•ä¸‹ï¼Œä¼šæ–°ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼šid_rsa.pubå’Œid_rsaã€‚å‰è€…æ˜¯ä½ çš„å…¬é’¥ï¼Œåè€…æ˜¯ä½ çš„ç§é’¥ã€‚
# æŠŠå…¬é’¥æ”¾åˆ°è¿œç¨‹æœåŠ¡å™¨
ssh-copy-id user@remote -p port
# æ¯”å¦‚æˆ‘çš„ ssh-copy-id zhm@120.79.52.223

</code></pre>
<p>ssh-copy-idåŸºæœ¬éƒ½å®‰è£…äº†ï¼Œä¸‡ä¸€æ²¡æœ‰ï¼Œmacä¸Šbrew install ssh-copy-idã€‚<br>
windowséº»çƒ¦ç‚¹ssh user@remote -p port 'mkdir -p .ssh &amp;&amp; cat &gt;&gt; .ssh/authorized_keys' &lt; ~/.ssh/id_rsa.pubï¼Œæ„æ€æ˜¯åœ¨è¿œç«¯æ‰§è¡Œæ–°å»º .ssh æ–‡ä»¶å¤¹ï¼Œå¹¶æŠŠæœ¬åœ°çš„ ~/.ssh/id_rsa.pub ï¼ˆä¹Ÿå°±æ˜¯å…¬é’¥ï¼‰è¿½åŠ åˆ°è¿œç«¯çš„ .ssh/authorized_keys ä¸­ã€‚å½“ç„¶ï¼Œä¸ä½¿ç”¨è¿™æ¡å‘½ä»¤çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ“ä½œè¿™ä¸ªè¿‡ç¨‹ï¼Œå³å…ˆå¤åˆ¶å…¬é’¥ï¼Œå†ç™»å…¥è¿œç¨‹æœºå™¨ï¼Œç²˜è´´åˆ° .ssh/authorized_keys å½“ä¸­ã€‚</p>
<h3 id="é…ç½®åˆ«å">é…ç½®åˆ«å</h3>
<p>æ¯æ¬¡éƒ½è¾“å…¥ ssh user@remote -p portï¼Œæ—¶é—´ä¹…äº†ä¹Ÿä¼šè§‰å¾—å¾ˆéº»çƒ¦ï¼Œç‰¹åˆ«æ˜¯å½“ user, remote å’Œ port éƒ½å¾—è¾“å…¥ï¼Œè€Œä¸”è¿˜ä¸å¥½è®°å¿†çš„æ—¶å€™ã€‚é…ç½®åˆ«åå¯ä»¥è®©æˆ‘ä»¬è¿›ä¸€æ­¥å·æ‡’ã€‚æ¯”å¦‚æˆ‘æƒ³ç”¨ssh labæ›¿æ¢ä¸Šé¢ä¸€ä¸²</p>
<pre><code># cat&gt;&gt;æŸæ–‡ä»¶&lt;&lt;EOFè¿½åŠ ä¸‹å†…å®¹ï¼Œ &gt;&gt; è¿½åŠ çš„æ„æ€ &lt;&lt;EOF é‡åˆ°EOFç»ˆæ­¢
# å› ä¸ºæ˜¯å‰ç«¯ï¼Œç›´æ¥ç”¨vscodeç¼–è¾‘
code ~/.ssh/config
# è¿½åŠ ä»¥ä¸‹å†…å®¹ï¼Œä¿å­˜
Host lab
    HostName remote
    User user
    Port port

# æ¥ç™»å½•å§
ssh lab

# æ¯”å¦‚æˆ‘çš„
# Host han
    # HostName 120.79.52.223
    # User zhm
    # Port 22
# ssh han
</code></pre>
<h3 id="å‘½ä»¤è¡Œæ‰§è¡Œç™»å½•å¹¶ä¸”åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤">å‘½ä»¤è¡Œæ‰§è¡Œç™»å½•å¹¶ä¸”åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤</h3>
<p>å‘½ä»¤è¡Œæ‰§è¡Œç™»å½•å¹¶ä¸”åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤:</p>
<pre><code># å•å¼•å·æˆ–è€…åŒå¼•å·ï¼Œå°†å‘½ä»¤åŒ…èµ·æ¥ï¼Œç„¶ååˆ†å·éš”å¼€å‘½ä»¤
ssh user@remoteNode &quot;cd /home ; ls&quot;
</code></pre>
<p>å¦‚æœæ˜¯å¾ˆå¤šå‘½ä»¤çš„è¯ï¼Œéœ€è¦å»ºä¸€ä¸ªè„šæœ¬ã€‚</p>
<pre><code># å»ºä¸€ä¸ªè„šæœ¬æ–‡ä»¶test.shï¼Œé‡Œé¢å†™ä¸Šè¿™ä¸ªï¼Œç„¶åæ‰§è¡Œ sh test.sh
#!/bin/bash  
# è¿œç¨‹æ‰§è¡Œçš„å†…å®¹åœ¨&quot;&lt; &lt; remotessh &quot; è‡³&quot; remotessh &quot;ä¹‹é—´ï¼Œå¦‚æœä¸æƒ³æœ¬æœºå‡ºç°æ—¥å¿—çš„è¯ ssh user@remoteNode &gt;/dev/null 2&gt;&amp;1   &lt;&lt; remotessh
ssh user@remoteNode &lt;&lt; remotessh
ls
exit
remotessh
</code></pre>
<h3 id="ä¼ è¾“æ–‡ä»¶">ä¼ è¾“æ–‡ä»¶</h3>
<p>ä¸¤å°æœºå™¨é—´æ–‡ä»¶ä¼ è¾“å¯ä»¥ç”¨scpï¼Œå®ƒçš„åœ°å€æ ¼å¼ä¸ ssh åŸºæœ¬ç›¸åŒï¼Œéƒ½æ˜¯å¯ä»¥çœç•¥ç”¨æˆ·åå’Œç«¯å£ï¼Œç¨å¾®çš„å·®åˆ«åœ¨ä¸æŒ‡å®šç«¯å£æ—¶ç”¨çš„æ˜¯å¤§å†™çš„ -P è€Œä¸æ˜¯å°å†™çš„ã€‚ä¸è¿‡ï¼Œå¦‚æœä½ å·²ç»é…ç½®äº†åˆ«åï¼Œé‚£ä¹ˆè¿™éƒ½ä¸é‡è¦ï¼Œå› ä¸º scp ä¹Ÿæ”¯æŒç›´æ¥ç”¨åˆ«å</p>
<pre><code># æ€»çš„ï¼šæœ¬æœºçš„å¯ä»¥çœç•¥ç”µè„‘çš„ipï¼Œé»˜è®¤çš„è¿œç¨‹å½“å‰æ–‡ä»¶å¤¹æ˜¯ Homeç›®å½•ï¼ˆ~ï¼‰ï¼Œå°†Aç”µè„‘ä¸Šçš„æ–‡ä»¶å¤åˆ¶åˆ°Bç”µè„‘ä¸Š
# æ³¨æ„çš„åœ°æ–¹ï¼šAè‹¥æ˜¯æ–‡ä»¶ï¼ŒBç”µè„‘è‹¥ä¹Ÿæ˜¯æ–‡ä»¶çš„è·¯å¾„ï¼Œä¸ç®¡æ–‡ä»¶å­˜ä¸å­˜åœ¨ï¼Œéƒ½ä¼šå°†Aæ–‡ä»¶å†…å®¹å†™å…¥åˆ°Bè¿™ä¸ªæ–‡ä»¶ã€‚
#                    Bç”µè„‘è‹¥æ˜¯æ–‡ä»¶å¤¹ï¼Œä¸ç®¡æ–‡ä»¶å¤¹å­˜ä¸å­˜åœ¨ï¼Œéƒ½ä¼šåœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ç”ŸæˆAç”µè„‘åŒåçš„æ–‡ä»¶å’Œå†…å®¹ï¼Œæœ‰çš„è¯åˆ™ä¼šè¦†ç›–åŒåæ–‡ä»¶
# Aè‹¥æ˜¯æ–‡ä»¶å¤¹ï¼ŒåŠ ä¸Š-rï¼ŒBç”µè„‘è‹¥æ˜¯æ–‡ä»¶çš„è·¯å¾„ä¼šæŠ¥é”™ï¼ŒBç”µè„‘è‹¥æ˜¯æ–‡ä»¶å¤¹è·¯å¾„ï¼Œæ–‡ä»¶å¤¹ä¸å­˜åœ¨çš„è¯åˆ™ä¼šå»ºç«‹è¿™ä¸ªæ–‡ä»¶å¤¹ä¸”æ”¾å…¥Aæ–‡ä»¶å¤¹é‡Œé¢çš„å†…å®¹ï¼ˆç›¸å½“äºå°†Aæ–‡ä»¶å¤¹æŒªè¿‡å»ç„¶åé‡å‘½åï¼‰ï¼Œæ–‡ä»¶å¤¹å­˜åœ¨çš„è¯ï¼Œä¼šåœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢ç”Ÿæˆä¸€ä¸ªå’ŒAåŒåçš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢å†…å®¹ä¸€è‡´
scp Aç”µè„‘:æ–‡ä»¶è·¯å¾„ Bç”µè„‘:æ–‡ä»¶è·¯å¾„

# æŠŠæœ¬åœ°çš„ /path/to/local/file æ–‡ä»¶ä¼ è¾“åˆ°è¿œç¨‹çš„ /path/to/remote/file  
scp -P port /path/to/local/file user@remote:/path/to/remote/file

# ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ«å
scp /path/to/local/file lab:/path/to/remote/file

# æŠŠè¿œç¨‹çš„ /path/to/remote/file ä¸‹è½½åˆ°æœ¬åœ°çš„ /path/to/local/file
scp lab:/path/to/remote/file /path/to/local/file

# è¿œç¨‹çš„é»˜è®¤è·¯å¾„æ˜¯å®¶ç›®å½•
# ä¸‹é¢å‘½ä»¤æŠŠå½“å‰ç›®å½•ä¸‹çš„ file ä¼ åˆ°è¿œç¨‹çš„ ~/dir/file
scp file lab:dir/file

# åŠ ä¸Š -r å‘½ä»¤å¯ä»¥ä¼ é€æ–‡ä»¶å¤¹
# ä¸‹é¢å‘½ä»¤å¯ä»¥æŠŠå½“å‰ç›®å½•ä¸‹çš„ dir æ–‡ä»¶å¤¹ä¼ åˆ°è¿œç¨‹çš„å®¶ç›®å½•ä¸‹
scp -r dir lab:

# åˆ«å¿˜äº† . å¯ä»¥ç”¨æ¥æŒ‡ä»£å½“å‰ç›®å½•
# ä¸‹é¢å‘½ä»¤å¯ä»¥æŠŠè¿œç¨‹çš„ ~/dir ç›®å½•ä¸‹è½½åˆ°å½“å‰ç›®å½•é‡Œé¢
scp -r lab:dir/ .
</code></pre>
<p>å¦‚æœè§‰å¾—ä½¿ç”¨å‘½ä»¤è¡Œä¼ è¾“æ–‡ä»¶æµ‘èº«ä¸è‡ªåœ¨ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ SFTP åè®®ã€‚ä»»ä½•æ”¯æŒ SFTP åè®®çš„å®¢æˆ·ç«¯éƒ½èƒ½ç”¨ä½ çš„ SSH è´¦å·ä¿¡æ¯ç™»å…¥å¹¶ç®¡ç†æ–‡ä»¶ï¼Œæ¯”å¦‚å¼€æºçš„æœ‰å›¾å½¢åŒ–ç•Œé¢çš„FTPå®¢æˆ·ç«¯ FileZillaã€‚åˆ«å¿˜äº†ï¼Œåœ¨è¿™äº›å®¢æˆ·ç«¯é‡Œé¢ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å®šä½ çš„ç§é’¥ï¼ˆ~/.ssh/id_rsaï¼‰ï¼Œç„¶åå°±èƒ½åšåˆ°æ— å¯†ç ç™»å…¥äº†ã€‚</p>
<h3 id="ä¿æŒç¨‹åºåœ¨åå°è¿è¡Œ">ä¿æŒç¨‹åºåœ¨åå°è¿è¡Œ</h3>
<p>ä»¥ä¸‹å‘½ä»¤å‡åœ¨æœåŠ¡å™¨æ‰§è¡Œ</p>
<h4 id="nohup">nohup</h4>
<pre><code># è®©ç¨‹åºåœ¨åå°è¿è¡Œ æ¯”å¦‚ nohup node index.js &amp;
nohup ä¸€ç›´æ‰§è¡Œçš„å‘½ä»¤ &amp;
# çœ‹ä¸‹ä»»åŠ¡å· nodeçš„é‚£ä¸ª
ps
# å¦‚æœéœ€è¦ç»ˆæ­¢çš„è¯
kill 21455
</code></pre>
<h4 id="tmux">tmux</h4>
<p>tmuxæ›´èƒ½æ‰§è¡Œå¤æ‚çš„ç¨‹åºï¼Œtmuxè¿˜èƒ½ç®¡ç†å¤šä¸ªçª—å£ï¼Œçª—å£åˆ‡åˆ†ï¼Œå¤åˆ¶ç²˜è´´ç­‰ç­‰ï¼Œmacç”¨æˆ·ä½¿ç”¨tmuxæ›´æ–¹ä¾¿ï¼Œæ–°å»ºä¼šè¯tmux -CCï¼Œæ¢å¤çš„æ—¶å€™tmux -CC attach</p>
<pre><code># æœåŠ¡å™¨ä¸Šå®‰è£…tmux
sudo apt-get install tmux

# è¿è¡Œtmuxï¼Œè¿›å…¥ä¼šè¯ï¼Œæ­¤æ—¶è¿è¡Œä»»ä½•ä¸œè¥¿éƒ½ä¸ä¼šå› ä¸ºé€€å‡ºsshè€Œè¢«æ€æ­»
tmux

# æš‚æ—¶ç¦»å¼€ä¼šè¯ ctrl+b å†æŒ‰ä¸‹d

# æ¢å¤ä¼šè¯
# tmux attach

# tmuxå‘½ä»¤å¿…é¡»è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Š
</code></pre>
<p>ä»¥ä¸Šå†…å®¹æ¥è‡ª<a href="https://juejin.im/post/5ce4a082e51d4577583ddc24">sshå…å¯†ç™»å½•æœåŠ¡å™¨å’Œscpçš„ä½¿ç”¨</a></p>
<h3 id="åŸºäºrsyncçš„éƒ¨ç½²">åŸºäºrsyncçš„éƒ¨ç½²</h3>
<p>å‚è€ƒ<a href="https://segmentfault.com/a/1190000015669114">rsync çš„ä½¿ç”¨æ–¹æ³•</a></p>
<h3 id="scpå’Œrsyncçš„åŒºåˆ«">scpå’Œrsyncçš„åŒºåˆ«</h3>
<h4 id="scpå‘½ä»¤">scpå‘½ä»¤</h4>
<p>1.scp æ˜¯ secure copy çš„ç¼©å†™ï¼Œç”¨äºè¿œç¨‹çš„æ–‡ä»¶çš„å¤åˆ¶ã€‚</p>
<p>2.å‚æ•°ï¼š</p>
<pre><code>-rï¼š é€’å½’å¤åˆ¶æ•´ä¸ªç›®å½•ã€‚
</code></pre>
<p>3.å®ä¾‹ï¼š</p>
<pre><code>scp /home/space/music/1.mp3 username@ip/home/root/others/music     
scp /home/space/music/1.mp3 username@ip/home/root/others/music/001.mp3
</code></pre>
<p>å¦‚æœæ˜¯è¿œç¨‹å¤åˆ¶ç›®å½•å°±åŠ ä¸Š -r å‚æ•° å³å¯ï¼ˆé‡å‘½åç›®å½•ï¼Œå°±ç›´æ¥åœ¨å‘½ä»¤åé¢æ·»åŠ ï¼Œå‰æä¿è¯ç›®æ ‡åœ°å€æ²¡æœ‰è¯¥ç›®å½•ï¼‰</p>
<pre><code>scp -r /home/space/music/ username@ip:/home/root/others/music_new
</code></pre>
<p>æŠŠæœ¬åœ°musicç›®å½•å¤åˆ¶åˆ°å¦ä¸€å°æœåŠ¡å™¨çš„othersä¸‹ï¼Œå¹¶é‡å‘½åä¸ºmusic_new</p>
<h4 id="rsync">rsync</h4>
<p>1.rsync æ˜¯ remote sync çš„ç¼©å†™ï¼Œç”¨äºlinuxç³»ç»Ÿä¸‹çš„æ•°æ®é•œåƒå¤‡ä»½å·¥å…·ï¼Œè¿œç¨‹æœåŠ¡å™¨ä¹‹é—´çš„æ–‡ä»¶æ‹·è´ã€‚<br>
2.å‚æ•°ï¼š</p>
<pre><code>-a, --archive å½’æ¡£æ¨¡å¼ï¼Œè¡¨ç¤ºä»¥é€’å½’æ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œå¹¶ä¿æŒæ‰€æœ‰æ–‡ä»¶å±æ€§ï¼Œç­‰äº-rlptgoDã€‚
-v, --verbose è¯¦ç»†æ¨¡å¼è¾“å‡ºã€‚
-z, --compress å¯¹å¤‡ä»½çš„æ–‡ä»¶åœ¨ä¼ è¾“æ—¶è¿›è¡Œå‹ç¼©å¤„ç†ã€‚
-P, --partial ä¿ç•™é‚£äº›å› æ•…æ²¡æœ‰å®Œå…¨ä¼ è¾“çš„æ–‡ä»¶ï¼Œä»¥æ˜¯åŠ å¿«éšåçš„å†æ¬¡ä¼ è¾“ã€‚
</code></pre>
<p>3.å®ä¾‹ï¼š</p>
<pre><code>rsync -avp mylog /home/
</code></pre>
<p>scpæ˜¯ç›¸å½“äºå¤åˆ¶ï¼Œé»è´´ï¼Œå¦‚æœæœ‰çš„è¯æ˜¯è¦†ç›–ï¼Œæ¯”è¾ƒè€—æ—¶é—´ï¼Œä¸æ™ºèƒ½ã€‚</p>
<p>rsyncæ˜¯å¤åˆ¶ï¼Œå¦‚æœæœ‰é‡å¤çš„æ–‡ä»¶ï¼Œä¼šç›´æ¥è·³è¿‡ï¼Œè€Œä¸”ä»–è‡ªå·±çš„ç®—æ³•ä¼˜åŒ–ã€‚</p>
<p>scpæ˜¯æŠŠæ–‡ä»¶å…¨éƒ¨å¤åˆ¶è¿‡å»ï¼Œå½“æ–‡ä»¶ä¿®æ”¹åè¿˜æ˜¯æŠŠæ‰€æœ‰æ–‡ä»¶å¤åˆ¶è¿‡å»ï¼Œrsync ç¬¬ä¸€æ¬¡æ˜¯æŠŠæ‰€æœ‰æ–‡ä»¶åŒæ­¥è¿‡å»ï¼Œå½“æ–‡ä»¶ä¿®æ”¹åï¼ŒåªæŠŠä¿®æ”¹çš„æ–‡ä»¶åŒæ­¥è¿‡å»ã€‚</p>
<h3 id="å‰ç«¯åŸºäºscpæˆ–rsyncçš„è‡ªåŠ¨éƒ¨ç½²">å‰ç«¯åŸºäºscpæˆ–rsyncçš„è‡ªåŠ¨éƒ¨ç½²</h3>
<p>1ã€åŸºäºscp,æ–°å¢éƒ¨ç½²è„šæœ¬æ–‡ä»¶ï¼Œå¦‚deploy.sh</p>
<pre><code># å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­ distä¸ºè¦ä¸Šä¼ çš„æ–‡ä»¶æ‰€åœ¨ç›®å½•
echo å‹ç¼©éƒ¨ç½²åŒ…ï¼
tar -zcvf dist.tar.gz dist/

# ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆéœ€è¦è¾“å…¥å¯†ç ï¼Œå¦‚æœå·²ç»è¿›è¡Œè¿‡ç§é’¥é…ç½®ï¼Œåˆ™ä¸ç”¨ï¼‰ï¼Œå…¶ä¸­/home/savoygu/gusaifei ä¸ºä¸Šä¼ æ–‡ä»¶æ‰€åœ¨ç›®å½•
echo ä¸Šä¼ æ–‡ä»¶
scp -r dist.tar.gz è´¦å·@æœåŠ¡å™¨ip:æœåŠ¡å™¨ä¸Šä¼ è·¯å¾„

# ç™»å½•åˆ°æœåŠ¡å™¨ï¼ˆéœ€è¦è¾“å…¥å¯†ç ï¼Œå¦‚æœå·²ç»è¿›è¡Œè¿‡ç§é’¥é…ç½®ï¼Œåˆ™ä¸ç”¨ï¼‰
# æœåŠ¡å™¨ç¯å¢ƒå¼€å¯
ssh è´¦å·@æœåŠ¡å™¨ip -tt &lt;&lt; EOF

# è¿›å…¥ç›®æ ‡ç›®å½•
cd æœåŠ¡å™¨ä¸Šä¼ è·¯å¾„
# è§£å‹
sudo tar -zxvf dist.tar.gz --strip-components 1
# ç§»é™¤çº¿ä¸Šå‹ç¼©æ–‡ä»¶
sudo rm -rf

exit
EOF
# æœåŠ¡å™¨ç¯å¢ƒç»“æŸ
echo ä¸Šä¼ å®Œæˆï¼

# ç§»é™¤æœ¬åœ°å‹ç¼©æ–‡ä»¶
echo åˆ é™¤æœ¬åœ°å‹ç¼©åŒ…ï¼
rm -rf dist.tar.gz
</code></pre>
<p>ä½¿ç”¨rsyncåŒç†</p>
<p>2ã€å‰ç«¯ä½¿ç”¨è„šæœ¬</p>
<pre><code>  &quot;scripts&quot;: {
    &quot;deploy&quot;: &quot;cross-env NODE_ENV=production umi build &amp;&amp; ./deploy.sh&quot;
  }
</code></pre>
<p>å¯ç»“åˆgitlabCIï¼ŒTravis CIå®ç°æŒç»­é›†æˆï¼Œå‚è€ƒ</p>
<ul>
<li><a href="https://juejin.im/post/5cb693b66fb9a0687a1719d3">æŒç»­é›†æˆæœåŠ¡ gitlabCIæ•™ç¨‹</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2017/12/travis_ci_tutorial.html">æŒç»­é›†æˆæœåŠ¡ Travis CIæ•™ç¨‹</a></li>
</ul>
<h3 id="é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç†</h3>
<p>1ã€æƒé™é—®é¢˜</p>
<pre><code>.sshç›®å½•ï¼Œä»¥åŠ/home/å½“å‰ç”¨æˆ· éœ€è¦700æƒé™ï¼Œå‚è€ƒä»¥ä¸‹æ“ä½œè°ƒæ•´
sudo chmod 700 ~/.ssh
sudo chmod 700 /home/å½“å‰ç”¨æˆ·
.sshç›®å½•ä¸‹çš„authorized_keysæ–‡ä»¶éœ€è¦600æˆ–644æƒé™ï¼Œå‚è€ƒä»¥ä¸‹æ“ä½œè°ƒæ•´
sudo chmod 600 ~/.ssh/authorized_keys
</code></pre>
<p>2ã€StrictModesé—®é¢˜</p>
<pre><code>ç¼–è¾‘
sudo vi /etc/ssh/sshd_config
æ‰¾åˆ°
#StrictModes yes
æ”¹æˆ
StrictModes no
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ä½¿ç”¨commitizençš„æ­£ç¡®å§¿åŠ¿ ]]></title>
        <id>http://fanguyun214.github.io/post/shi-yong-commitizen-de-zheng-que-zi-shi</id>
        <link href="http://fanguyun214.github.io/post/shi-yong-commitizen-de-zheng-que-zi-shi">
        </link>
        <updated>2019-07-18T06:52:44.000Z</updated>
        <summary type="html"><![CDATA[<p>æˆ‘ä»¬åœ¨æ¯æ¬¡æäº¤ä»£ç æ—¶ï¼Œéƒ½éœ€è¦ç¼–å†™Commit Messageï¼Œå¦åˆ™æ˜¯ä¸å…è®¸æäº¤çš„ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æˆ‘ä»¬åœ¨æ¯æ¬¡æäº¤ä»£ç æ—¶ï¼Œéƒ½éœ€è¦ç¼–å†™Commit Messageï¼Œå¦åˆ™æ˜¯ä¸å…è®¸æäº¤çš„ã€‚</p>
<!-- more -->
<pre><code>git commit -m â€œfirst commit with userInfo serviceâ€
</code></pre>
<p>ç¼–å†™Commit Messageéœ€è¦éµå¾ªä¸€å®šçš„èŒƒå¼ï¼Œå†…å®¹åº”è¯¥æ¸…æ™°æ˜äº†ï¼ŒæŒ‡æ˜æœ¬æ¬¡æäº¤çš„ç›®çš„ï¼Œä¾¿äºæ—¥åè¿½è¸ªé—®é¢˜ã€‚<br>
commitizenå°±æ˜¯è¿™ä¹ˆæ ·ä¸€æ¬¾å·¥å…·,ä»–ç”¨æ¥è§„èŒƒåŒ–æˆ‘ä»¬çš„commitæ¶ˆæ¯ã€‚</p>
<h3 id="å®‰è£…æŒ‡å—">å®‰è£…æŒ‡å—</h3>
<p>å®‰è£…commitizen</p>
<pre><code>sudo npm install -g commitizen
</code></pre>
<h3 id="é…ç½®">é…ç½®</h3>
<p>cdåˆ°.gitæ‰€åœ¨ç›®å½•</p>
<pre><code>commitizen init cz-conventional-changelog --save --save-exact
</code></pre>
<p>ä½¿ç”¨<br>
ç”¨git czå‘½ä»¤æ¥å–ä»£git commit</p>
<pre><code> npm install --global cz-emoji
 set as default adapter for your projects
 echo '{ &quot;path&quot;: &quot;cz-emoji&quot; }' &gt; ~/.czrc
</code></pre>
<h3 id="å¼‚å¸¸æƒ…å†µ">å¼‚å¸¸æƒ…å†µ</h3>
<p>æœ‰å¯èƒ½æç¤ºä½ ç¼ºå°‘package.json<br>
é…ç½®ç¬¬äºŒä¸ªé¡¹ç›®<br>
å½“æˆ‘ä»¬é…ç½®ç¬¬äºŒä¸ªé¡¹ç›®çš„æ—¶å€™æˆ‘ä»¬åªéœ€è¦è¿›å…¥åˆ°å¯¹åº”çš„.gitæ–‡ä»¶å¤¹ä¸‹ï¼Œè¾“å…¥å¦‚ä¸‹çš„å‘½ä»¤</p>
<pre><code>commitizen init cz-conventional-changelog --force
</code></pre>
<p>æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨git czå‘½ä»¤äº†</p>
<h3 id="commitizenè¯¦è§£">commitizenè¯¦è§£</h3>
<pre><code>Message æ ¼å¼
ä¸€èˆ¬æ¥è¯´ï¼ŒCommit Message åº”åŒ…å«ä¸‰éƒ¨åˆ†å†…å®¹ï¼šHeaderã€Bodyã€Footer
&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;
&lt;body&gt;
&lt;footer&gt;
Header
Headeréƒ¨åˆ†åº”åªåŒ…å«ä¸€è¡Œï¼ŒåŒ…æ‹¬ä¸‰ä¸ªå­—æ®µï¼štypeã€scopeå’Œsubject
type typeç”¨äºè¯´æ˜Commitçš„ç±»å‹ï¼ŒåŒ…å«ä¸€ä¸‹7ç§ç±»å‹
    featï¼šæ–°åŠŸèƒ½ï¼ˆfeatureï¼‰
    fixï¼šä¿®è¡¥bug
    docsï¼šæ–‡æ¡£ï¼ˆdocumentationï¼‰
    styleï¼š æ ¼å¼ï¼ˆä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨ï¼‰
    refactorï¼šé‡æ„ï¼ˆå³ä¸æ˜¯æ–°å¢åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®æ”¹bugçš„ä»£ç å˜åŠ¨ï¼‰
    testï¼šå¢åŠ æµ‹è¯•
    choreï¼šæ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

scope
    scopeç”¨äºè¯´æ˜æœ¬æ¬¡Commitæ‰€å½±å“çš„èŒƒå›´ï¼Œæ¯”å¦‚controllerã€useræˆ–è€…READMEï¼Œè§†é¡¹ç›®çš„ä¸åŒè€Œä¸åŒ
subject
subjectæ˜¯æœ¬æ¬¡Commitç›®çš„çš„ç®€çŸ­æè¿°ï¼Œä¸€èˆ¬ä¸è¦è¶…è¿‡50ä¸ªå­—ç¬¦
    ä»¥åŠ¨è¯å¼€å¤´ï¼Œä½¿ç”¨ç¬¬ä¸€äººç§°ç°åœ¨æ—¶ï¼Œæ¯”å¦‚changeï¼Œè€Œä¸æ˜¯changedæˆ–changes
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Reduxç®€ä»‹]]></title>
        <id>http://fanguyun214.github.io/post/redux-jian-jie</id>
        <link href="http://fanguyun214.github.io/post/redux-jian-jie">
        </link>
        <updated>2019-07-18T03:46:11.000Z</updated>
        <summary type="html"><![CDATA[<p>redux æ˜¯ä¸€ä¸ªçŠ¶æ€ç®¡ç†å™¨ï¼Œredux å’Œ react æ²¡æœ‰å…³ç³»ï¼Œredux å¯ä»¥ç”¨åœ¨ä»»ä½•æ¡†æ¶ä¸­ï¼Œå¿˜æ‰ reactã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>redux æ˜¯ä¸€ä¸ªçŠ¶æ€ç®¡ç†å™¨ï¼Œredux å’Œ react æ²¡æœ‰å…³ç³»ï¼Œredux å¯ä»¥ç”¨åœ¨ä»»ä½•æ¡†æ¶ä¸­ï¼Œå¿˜æ‰ reactã€‚</p>
 <!-- more --> 
<p>connect ä¸å±äº reduxï¼Œå®ƒå…¶å®å±äº react-reduxã€‚</p>
<p>è¯·ä¸€å®šå…ˆå¿˜è®° reducerã€storeã€dispatchã€middleware ç­‰ç­‰è¿™äº›åè¯ã€‚</p>
<p><strong>createStore</strong></p>
<p>åˆ›å»º store å¯¹è±¡ï¼ŒåŒ…å« getState, dispatch, subscribe, replaceReducer</p>
<p><strong>reducer</strong></p>
<p>reducer æ˜¯ä¸€ä¸ªè®¡åˆ’å‡½æ•°ï¼Œæ¥æ”¶æ—§çš„ state å’Œ actionï¼Œç”Ÿæˆæ–°çš„ state</p>
<p><strong>action</strong></p>
<p>action æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»åŒ…å« type å­—æ®µ</p>
<p><strong>dispatch</strong></p>
<p>dispatch( action ) è§¦å‘ actionï¼Œç”Ÿæˆæ–°çš„ state</p>
<p><strong>subscribe</strong></p>
<p>å®ç°è®¢é˜…åŠŸèƒ½ï¼Œæ¯æ¬¡è§¦å‘ dispatch çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œè®¢é˜…å‡½æ•°</p>
<p><strong>combineReducers</strong></p>
<p>å¤š reducer åˆå¹¶æˆä¸€ä¸ª reducer</p>
<p><strong>replaceReducer</strong></p>
<p>æ›¿æ¢ reducer å‡½æ•°</p>
<p><strong>middleware</strong></p>
<p>æ‰©å±• dispatch å‡½æ•°ï¼</p>
<p><strong>Reduxæµç¨‹å›¾</strong></p>
<p><img src="http://fanguyun214.github.io/post-images/1563424647611.jpg" alt="Reduxæµç¨‹å›¾"></p>
]]></content>
    </entry>
</feed>